---
title: "Do we understand inbreeding? A commentary on Clo et al. 2025"
format: html
editor: source
execute:
  warning: false
  message: false
---

## Load packages and helper functions

```{r}
library(tidyverse)
library(kableExtra)
library(DT)
library(brms)
library(tidybayes)

# Create a function to build HTML searchable tables

my_data_table <- function(df){
  datatable(
    df, rownames=FALSE,
    autoHideNavigation = TRUE,
    extensions = c("Scroller",  "Buttons"),
    options = list(
      autoWidth = TRUE,
      dom = 'Bfrtip',
      deferRender=TRUE,
      scrollX=TRUE, scrollY=1000,
      scrollCollapse=TRUE,
      buttons =
        list('pageLength', 'colvis', 'csv', list(
          extend = 'pdf',
          pageSize = 'A4',
          orientation = 'landscape',
          filename = 'inbreeding_studies')),
      pageLength = 100
    )
  )
}
```

## Literature search

To get the gist for the current state of the field, we searched the Web of Science for published journal articles that examined whether animals tolerated, preferred or avoided inbreeding. The following search string was used to search for studies published between the 1st of January 2020 to the 1st of February 2025: TS=("inbreeding tolerance") OR TS=("inbreeding preference") OR TS=("inbreeding avoidance"). Query link: https://www.webofscience.com/wos/woscc/summary/e4d61622-9f6b-48f1-b954-83c598431347-014b923814/relevance/1 This search criteria identified 188 studies. We were unable to access two studies and we removed a third from our full-text screen because it was not a journal article.  

From this initial list, we identified 121 studies where the authors stated whether they expected inbreeding preference, tolerance or avoidance to be present in their system. Of these, 81 had clear, evolutionary-driven hypotheses regarding inbreeding. These 81 studies were retained for analysis.   

## The dataset

Load and display the complete dataset. 

```{r}
data <- 
  read_delim("inbreeding_adaptive_refs.csv") %>% 
  mutate(ID = 1:n()) %>% 
  select(-Comment) %>% 
  rename(`Automatic transmission advantage mentioned?` = Automatic_transmission_advantage_mentioned,
         `Null hypothesis` = Null_expectation) %>% 
  mutate(`Null hypothesis` = case_when(`Null hypothesis` == "Bad" ~ "Inbreeding avoidance",
                                       `Null hypothesis` == "Good" ~ "Inbreeding preference/tolerance",
                                       `Null hypothesis` == "Balanced" ~ "Either possible",
                                       .default = `Null hypothesis`))

my_data_table(data %>% select(ID, Authors, Article_Title, Source_Title, Publication_Year, `Null hypothesis`, `Automatic transmission advantage mentioned?`, Article_Type, Relevant, Taxa, Accessed, `Publication Type`))

```

**Column explanations**

- ID: unique identifier for each study

- Authors: authors listed on publication

- Article_title: publication title

- Source_title: journal where study is published

- Publication_Year: year study was published 

- Null hypothesis: did the authors expect inbreeding preference, tolerance or avoidance to be present in their system. Neutral indicates they did introduced inbreeding but did not posit an evolutionary hypothesis regarding its presence. NA indicates no reference to inbreeding.

- Automatic transmission advantage mentioned: did the authors, whether by name or description, mention the automatic transmission advantage when making their evolutionary argument about inbreeding. 

- Article_type: was the study Empirical, a review, a meta-analysis or theoretical?

- Relevant: how central was inbreeding to the studies research question. 0 = not relevant, 1 = not central or 2 = central, or they clearly stated a evolutionary hypothesis about inbreeding in their system.

- Taxa: animal or plant.

- Accessed: 1 = we found the full text, 0 = we did not. 

- Publication type: J = journal article, B = book chapter.

## Clean the dataset and display data used for analysis

```{r}
analysis_data <- 
  data %>% 
  filter(Accessed == 1, # remove studies we couldn't access (also inlcudes the book chapter)
         Relevant > 1, # scored 0, 1, 2, only include 2s
         `Null hypothesis` != "Neutral") %>% # remove studies that mention inbreeding, but make no clear evolutionary prediction relating to it
  mutate(ID = 1:n()) %>% 
  select(ID, 3:11)
```

```{r}
my_data_table(analysis_data)
```

## Visualise the data

```{r}
analysis_data %>%
  group_by(`Automatic transmission advantage mentioned?`, 
           `Null hypothesis`) %>% 
  summarise(Studies = n()) %>% 
  knitr::kable(digits = 1, align = "lccc", position = "c") %>%
  kable_styling("striped") 
```

## Run Bernoulli model

We run a quick model to test whether acknowledgement of the automatic transmission advantage affects expectations about inbreeding avoidance, tolerance and preference. We group the 'either possible' and 'inbreeding preference/tolerance' categories together to contrast inbreeding avoidance expectations. We use the `brms` default priors, which are weakly informative and do not bias treatment effects.

```{r}
analysis_data_for_test <-
  analysis_data %>% 
  mutate(Hypothesis = case_when(
    `Null hypothesis` == "Inbreeding avoidance" ~ 1,
    `Null hypothesis` != "Inbreeding avoidance" ~ 0)) %>% 
  rename(ATA = `Automatic transmission advantage mentioned?`)


model <-
  brm(Hypothesis ~ 1 + ATA,
    data = analysis_data_for_test,
    family = bernoulli,
    iter = 8000, warmup = 2000,
    chains = 4, cores = 4,
    seed = 2, file = "fits/inbreeding_expectations_model")

model
```

The summary shows the studies that consider the ATA are far more likely to not assume inbreeding is universally maladaptive. Specifically, the 95% uncertainty intervals indicate the affect is negative i.e. a lower proportion of inbreeding avoidance expectations (coded as 1). However, this is shown on the logit scale, making interpretation difficult.

Lets convert to the response scale and present in a table:

```{r}

model_output_posterior <-
  as_draws_df(model) %>% 
  mutate(Prop_avoidance_NO = inv_logit_scaled(b_Intercept),
         Prop_avoidance_YES = inv_logit_scaled(b_Intercept + b_ATAYES),
         Difference = Prop_avoidance_NO - Prop_avoidance_YES) %>% 
  select(Prop_avoidance_NO, Prop_avoidance_YES, Difference) 

model_output_posterior %>% summarise_draws(mean, ~quantile(.x, probs = c(0.025, 0.975))) %>%
  mutate(across(2:4, ~ round(.x, 3))) %>% 
  mutate(variable = case_when(variable == "Prop_avoidance_NO" ~ "NO",
                              variable == "Prop_avoidance_YES" ~ "YES",
                                      .default = "Difference")) %>% 
  rename("ATA mentioned?" = variable,
        `Proportion of studies with avoidance expectation` = mean) %>% 
  kable()
  
```

